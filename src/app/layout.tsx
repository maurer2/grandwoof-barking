// copied from https://github.com/maurer2/blue-harvest/blob/main/src/app/layout.tsx
import type { Metadata } from 'next';

import 'modern-normalize/modern-normalize.css';
import Link from 'next/link';

import './globals.css';
import Providers from './providers';
import { getDataFromEndpoint } from './server-actions/getDataFromEndpoint/getDataFromEndpoint';

export const metadata: Metadata = {
  description: 'Generated by create next app',
  title: 'Create Next App',
};

const baseURL = 'https://swapi.dev/api';

export default async function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  const rootCategories = await getDataFromEndpoint<Record<string, string>>(baseURL);
  const rootCategoriesFormatted = Object.entries(rootCategories).flatMap(([label, path]) => ({
    label,
    path,
  }));

  return (
    <html lang="en">
      <body>
        <Providers>
          {Boolean(rootCategoriesFormatted.length) && (
            <nav>
              {rootCategoriesFormatted.map((category) => (
                <Link
                  href={{
                    pathname: category.label,
                  }}
                  key={category.label}
                >
                  {category.label}
                </Link>
              ))}
            </nav>
          )}
          {children}
        </Providers>
      </body>
    </html>
  );
}
